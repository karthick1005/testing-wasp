<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Federation Routing Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: #333;
        }
        
        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .demo-section h2 {
            color: #444;
            margin-bottom: 15px;
        }
        
        .demo-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .app-container {
            min-height: 500px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            color: #6c757d;
            font-style: italic;
            position: relative;
            overflow: hidden;
        }
        
        .app-container.loaded {
            border: none;
            background: white;
            color: inherit;
            font-style: normal;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #007bff;
        }
        
        .loading.show {
            display: block;
        }
        
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .routing-info {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .routing-info h4 {
            margin: 0 0 10px 0;
            color: #004085;
        }
        
        .routing-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .routing-info li {
            margin: 5px 0;
            color: #004085;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Module Federation Routing Demo</h1>
            <p>Testing multiple routing approaches with Webpack Module Federation</p>
        </div>
        
        <div class="demo-section">
            <h2>üì± Original Demo App (Single Page)</h2>
            <p>
                This loads the original demo app as a single component without routing. 
                Perfect for simple components that don't need internal navigation.
            </p>
            
            <div class="button-group">
                <button class="btn btn-primary" id="loadOriginalBtn">Load Original App</button>
                <button class="btn btn-secondary" id="unloadOriginalBtn" disabled>Unload App</button>
            </div>
            
            <div class="loading" id="originalLoading">
                <div>‚è≥ Loading original demo app...</div>
            </div>
            
            <div class="app-container" id="originalContainer">
                Click "Load Original App" to see the single-page demo
            </div>
            
            <div class="status" id="originalStatus" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>üß≠ Router-Enabled Demo App (Memory Router)</h2>
            <p>
                This loads the demo app with <strong>MemoryRouter</strong> - perfect for Module Federation 
                as it doesn't depend on the browser URL and manages its own routing state in memory.
            </p>
            
            <div class="routing-info">
                <h4>Available Routes (Memory Router):</h4>
                <ul>
                    <li><strong>/</strong> - Home page (original demo functionality)</li>
                    <li><strong>/dashboard</strong> - Dashboard with analytics overview</li>
                    <li><strong>/settings</strong> - Settings and configuration</li>
                    <li><strong>/profile</strong> - User profile information</li>
                </ul>
                <p><strong>Note:</strong> MemoryRouter manages routing internally without affecting the browser URL.</p>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="loadMemoryRouterBtn">Load Memory Router App</button>
                <button class="btn btn-secondary" id="unloadMemoryRouterBtn" disabled>Unload App</button>
            </div>
            
            <div class="loading" id="memoryRouterLoading">
                <div>‚è≥ Loading memory router demo app...</div>
            </div>
            
            <div class="app-container" id="memoryRouterContainer">
                Click "Load Memory Router App" to see the multi-page demo with in-memory navigation
            </div>
            
            <div class="status" id="memoryRouterStatus" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>üåê Router-Enabled Demo App (Browser Router)</h2>
            <p>
                This loads the demo app with <strong>BrowserRouter</strong> that adapts to the current URL context.
                It automatically detects if it should use a basename or not.
            </p>
            
            <div class="routing-info">
                <h4>Available Routes (Browser Router):</h4>
                <ul>
                    <li><strong>/</strong> - Home page (original demo functionality)</li>
                    <li><strong>/dashboard</strong> - Dashboard with analytics overview</li>
                    <li><strong>/settings</strong> - Settings and configuration</li>
                    <li><strong>/profile</strong> - User profile information</li>
                </ul>
                <p><strong>Note:</strong> BrowserRouter adapts to the current URL context and may update the browser URL.</p>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="loadBrowserRouterBtn">Load Browser Router App</button>
                <button class="btn btn-secondary" id="unloadBrowserRouterBtn" disabled>Unload App</button>
            </div>
            
            <div class="loading" id="browserRouterLoading">
                <div>‚è≥ Loading browser router demo app...</div>
            </div>
            
            <div class="app-container" id="browserRouterContainer">
                Click "Load Browser Router App" to see the multi-page demo with browser URL integration
            </div>
            
            <div class="status" id="browserRouterStatus" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>üè† Host-Optimized Demo App</h2>
            <p>
                This loads the demo app optimized for embedding in host applications like OpenSaaS. 
                It uses a contained design that preserves the host app's navbar and layout.
            </p>
            
            <div class="routing-info">
                <h4>Features for Host Integration:</h4>
                <ul>
                    <li><strong>Contained Height:</strong> Doesn't take full viewport height</li>
                    <li><strong>Memory Router:</strong> Won't interfere with host routing</li>
                    <li><strong>Styled Container:</strong> Rounded corners and shadow for embedding</li>
                    <li><strong>Preserved Navigation:</strong> Host navbar remains visible</li>
                </ul>
                <p><strong>Perfect for:</strong> Integration into OpenSaaS or other host applications.</p>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="loadHostBtn">Load Host-Optimized App</button>
                <button class="btn btn-secondary" id="unloadHostBtn" disabled>Unload App</button>
            </div>
            
            <div class="loading" id="hostLoading">
                <div>‚è≥ Loading host-optimized demo app...</div>
            </div>
            
            <div class="app-container" id="hostContainer">
                Click "Load Host-Optimized App" to see the embedded-friendly version
            </div>
            
            <div class="status" id="hostStatus" style="display: none;"></div>
        </div>
    </div>

    <!-- Load React from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script>
        let originalApp = null;
        let memoryRouterApp = null;
        let browserRouterApp = null;
        let hostApp = null;
        let originalRoot = null;
        let memoryRouterRoot = null;
        let browserRouterRoot = null;
        let hostRoot = null;

        // Initialize webpack sharing if not available
        if (typeof __webpack_init_sharing__ === 'undefined') {
            window.__webpack_init_sharing__ = () => Promise.resolve();
            window.__webpack_share_scopes__ = { default: {} };
        }

        // Original App Functions
        async function loadOriginalApp() {
            const btn = document.getElementById('loadOriginalBtn');
            const unloadBtn = document.getElementById('unloadOriginalBtn');
            const loading = document.getElementById('originalLoading');
            const container = document.getElementById('originalContainer');
            const status = document.getElementById('originalStatus');
            
            btn.disabled = true;
            loading.classList.add('show');
            status.style.display = 'none';
            
            try {
                // Load the remote entry
                const script = document.createElement('script');
                script.src = 'http://localhost:3002/remoteEntry.js';
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
                
                // Initialize sharing
                await __webpack_init_sharing__('default');
                const remotesContainer = window.demoReactApp;
                await remotesContainer.init(__webpack_share_scopes__.default);
                
                // Get the original app
                const factory = await remotesContainer.get('./DemoApp');
                originalApp = factory();
                
                // Render
                container.innerHTML = '';
                container.classList.add('loaded');
                originalRoot = ReactDOM.createRoot(container);
                originalRoot.render(React.createElement(originalApp.default));
                
                loading.classList.remove('show');
                unloadBtn.disabled = false;
                
                status.textContent = '‚úÖ Original demo app loaded successfully!';
                status.className = 'status success';
                status.style.display = 'block';
                
            } catch (error) {
                console.error('Failed to load original app:', error);
                loading.classList.remove('show');
                btn.disabled = false;
                
                status.textContent = `‚ùå Failed to load original app: ${error.message}`;
                status.className = 'status error';
                status.style.display = 'block';
            }
        }

        function unloadOriginalApp() {
            const btn = document.getElementById('loadOriginalBtn');
            const unloadBtn = document.getElementById('unloadOriginalBtn');
            const container = document.getElementById('originalContainer');
            const status = document.getElementById('originalStatus');
            
            if (originalRoot) {
                originalRoot.unmount();
                originalRoot = null;
            }
            
            container.innerHTML = 'Click "Load Original App" to see the single-page demo';
            container.classList.remove('loaded');
            
            btn.disabled = false;
            unloadBtn.disabled = true;
            
            status.textContent = 'üì§ Original app unloaded';
            status.className = 'status';
            status.style.display = 'block';
        }

        // Memory Router App Functions
        async function loadMemoryRouterApp() {
            const btn = document.getElementById('loadMemoryRouterBtn');
            const unloadBtn = document.getElementById('unloadMemoryRouterBtn');
            const loading = document.getElementById('memoryRouterLoading');
            const container = document.getElementById('memoryRouterContainer');
            const status = document.getElementById('memoryRouterStatus');
            
            btn.disabled = true;
            loading.classList.add('show');
            status.style.display = 'none';
            
            try {
                // Load the remote entry (if not already loaded)
                if (!window.demoReactApp) {
                    const script = document.createElement('script');
                    script.src = 'http://localhost:3002/remoteEntry.js';
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                }
                
                // Initialize sharing
                await __webpack_init_sharing__('default');
                const remotesContainer = window.demoReactApp;
                await remotesContainer.init(__webpack_share_scopes__.default);
                
                // Get the memory router app
                const factory = await remotesContainer.get('./DemoAppWithRouter');
                memoryRouterApp = factory();
                
                // Render
                container.innerHTML = '';
                container.classList.add('loaded');
                memoryRouterRoot = ReactDOM.createRoot(container);
                memoryRouterRoot.render(React.createElement(memoryRouterApp.default));
                
                loading.classList.remove('show');
                unloadBtn.disabled = false;
                
                status.textContent = '‚úÖ Memory Router demo app loaded successfully! Navigation is handled in memory.';
                status.className = 'status success';
                status.style.display = 'block';
                
            } catch (error) {
                console.error('Failed to load memory router app:', error);
                loading.classList.remove('show');
                btn.disabled = false;
                
                status.textContent = `‚ùå Failed to load memory router app: ${error.message}`;
                status.className = 'status error';
                status.style.display = 'block';
            }
        }

        function unloadMemoryRouterApp() {
            const btn = document.getElementById('loadMemoryRouterBtn');
            const unloadBtn = document.getElementById('unloadMemoryRouterBtn');
            const container = document.getElementById('memoryRouterContainer');
            const status = document.getElementById('memoryRouterStatus');
            
            if (memoryRouterRoot) {
                memoryRouterRoot.unmount();
                memoryRouterRoot = null;
            }
            
            container.innerHTML = 'Click "Load Memory Router App" to see the multi-page demo with in-memory navigation';
            container.classList.remove('loaded');
            
            btn.disabled = false;
            unloadBtn.disabled = true;
            
            status.textContent = 'üì§ Memory Router app unloaded';
            status.className = 'status';
            status.style.display = 'block';
        }

        // Browser Router App Functions
        async function loadBrowserRouterApp() {
            const btn = document.getElementById('loadBrowserRouterBtn');
            const unloadBtn = document.getElementById('unloadBrowserRouterBtn');
            const loading = document.getElementById('browserRouterLoading');
            const container = document.getElementById('browserRouterContainer');
            const status = document.getElementById('browserRouterStatus');
            
            btn.disabled = true;
            loading.classList.add('show');
            status.style.display = 'none';
            
            try {
                // Load the remote entry (if not already loaded)
                if (!window.demoReactApp) {
                    const script = document.createElement('script');
                    script.src = 'http://localhost:3002/remoteEntry.js';
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                }
                
                // Initialize sharing
                await __webpack_init_sharing__('default');
                const remotesContainer = window.demoReactApp;
                await remotesContainer.init(__webpack_share_scopes__.default);
                
                // Get the browser router app
                const factory = await remotesContainer.get('./DemoAppWithBrowserRouter');
                browserRouterApp = factory();
                
                // Render
                container.innerHTML = '';
                container.classList.add('loaded');
                browserRouterRoot = ReactDOM.createRoot(container);
                browserRouterRoot.render(React.createElement(browserRouterApp.default));
                
                loading.classList.remove('show');
                unloadBtn.disabled = false;
                
                status.textContent = '‚úÖ Browser Router demo app loaded successfully! Navigation may update the URL.';
                status.className = 'status success';
                status.style.display = 'block';
                
            } catch (error) {
                console.error('Failed to load browser router app:', error);
                loading.classList.remove('show');
                btn.disabled = false;
                
                status.textContent = `‚ùå Failed to load browser router app: ${error.message}`;
                status.className = 'status error';
                status.style.display = 'block';
            }
        }

        function unloadBrowserRouterApp() {
            const btn = document.getElementById('loadBrowserRouterBtn');
            const unloadBtn = document.getElementById('unloadBrowserRouterBtn');
            const container = document.getElementById('browserRouterContainer');
            const status = document.getElementById('browserRouterStatus');
            
            if (browserRouterRoot) {
                browserRouterRoot.unmount();
                browserRouterRoot = null;
            }
            
            container.innerHTML = 'Click "Load Browser Router App" to see the multi-page demo with browser URL integration';
            container.classList.remove('loaded');
            
            btn.disabled = false;
            unloadBtn.disabled = true;
            
            status.textContent = 'üì§ Browser Router app unloaded';
            status.className = 'status';
            status.style.display = 'block';
        }

        // Host-Optimized App Functions
        async function loadHostApp() {
            const btn = document.getElementById('loadHostBtn');
            const unloadBtn = document.getElementById('unloadHostBtn');
            const loading = document.getElementById('hostLoading');
            const container = document.getElementById('hostContainer');
            const status = document.getElementById('hostStatus');
            
            btn.disabled = true;
            loading.classList.add('show');
            status.style.display = 'none';
            
            try {
                // Load the remote entry (if not already loaded)
                if (!window.demoReactApp) {
                    const script = document.createElement('script');
                    script.src = 'http://localhost:3002/remoteEntry.js';
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                }
                
                // Initialize sharing
                await __webpack_init_sharing__('default');
                const remotesContainer = window.demoReactApp;
                await remotesContainer.init(__webpack_share_scopes__.default);
                
                // Get the host-optimized app
                const factory = await remotesContainer.get('./DemoAppForHost');
                hostApp = factory();
                
                // Render
                container.innerHTML = '';
                container.classList.add('loaded');
                hostRoot = ReactDOM.createRoot(container);
                hostRoot.render(React.createElement(hostApp.default));
                
                loading.classList.remove('show');
                unloadBtn.disabled = false;
                
                status.textContent = '‚úÖ Host-optimized demo app loaded! This version is perfect for embedding in OpenSaaS.';
                status.className = 'status success';
                status.style.display = 'block';
                
            } catch (error) {
                console.error('Failed to load host app:', error);
                loading.classList.remove('show');
                btn.disabled = false;
                
                status.textContent = `‚ùå Failed to load host app: ${error.message}`;
                status.className = 'status error';
                status.style.display = 'block';
            }
        }

        function unloadHostApp() {
            const btn = document.getElementById('loadHostBtn');
            const unloadBtn = document.getElementById('unloadHostBtn');
            const container = document.getElementById('hostContainer');
            const status = document.getElementById('hostStatus');
            
            if (hostRoot) {
                hostRoot.unmount();
                hostRoot = null;
            }
            
            container.innerHTML = 'Click "Load Host-Optimized App" to see the embedded-friendly version';
            container.classList.remove('loaded');
            
            btn.disabled = false;
            unloadBtn.disabled = true;
            
            status.textContent = 'üì§ Host-optimized app unloaded';
            status.className = 'status';
            status.style.display = 'block';
        }

        // Event listeners
        document.getElementById('loadOriginalBtn').addEventListener('click', loadOriginalApp);
        document.getElementById('unloadOriginalBtn').addEventListener('click', unloadOriginalApp);
        document.getElementById('loadMemoryRouterBtn').addEventListener('click', loadMemoryRouterApp);
        document.getElementById('unloadMemoryRouterBtn').addEventListener('click', unloadMemoryRouterApp);
        document.getElementById('loadBrowserRouterBtn').addEventListener('click', loadBrowserRouterApp);
        document.getElementById('unloadBrowserRouterBtn').addEventListener('click', unloadBrowserRouterApp);
        document.getElementById('loadHostBtn').addEventListener('click', loadHostApp);
        document.getElementById('unloadHostBtn').addEventListener('click', unloadHostApp);
    </script>
</body>
</html>
